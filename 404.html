<!DOCTYPE html>
<!--
   //////////////////////////////////////////////////////////////////////////
   //                                                                      //
   //    This file is automatically generated by the publish.py script.    //
   //    Any changes made manually will be overwritten during the next     //
   //    publish action.                                                   //
   //                                                                      //
   //////////////////////////////////////////////////////////////////////////
-->
<head>
   <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
   <meta http-equiv="Pragma" content="no-cache">
   <meta http-equiv="Expires" content="-1">
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>MusicBrainz Picard Documentation</title>
</head>
<body>
   <!-- <div id='test'></div> -->
   <script>
      var target_language = 'en';
      var target_version = '';
      var latest_version = '2.5.2';
      var supported_languages = ['en', 'fr'];
      var version_list = ['2.3.2', '2.4', '2.4.1', '2.4.2', '2.4.4', '2.5', '2.5.1', '2.5.2'];
      var src_host = window.location.hostname;
      var src_protocol = window.location.protocol;
      var src_path = window.location.pathname;
      var src_path_parts = src_path.split('/');
      var target_path = '';
      var target_url = '';
      var has_version = false;
      var has_language = false;
      var has_rtd_format = false;

      const re_language = /^[a-z][a-z](-[A-Z][A-Z])?$/;
      const re_version1 = /^[0-9][0-9\.]*$/;
      const re_version2 = /^v[0-9][0-9\.]*$/;

      function is_language(test_language) {
         // window.alert("Testing language: " + test_language);
         if (test_language.search(re_language) < 0) {
            // window.alert("Failed regular expression check.");
            return false;
         }
         if (supported_languages.indexOf(test_language) < 0) {
            // window.alert("Failed supported languages check.");
            return false;
         }
         target_language = test_language;
         has_language = true;
         // window.alert("Passed.  Target language set to: " + target_language);
         return true;
      }

      function is_rtd_version(test_version) {
         // window.alert("Testing RTD version: " + test_version);
         if (test_version.search(re_version1) < 0) {
            // window.alert("Failed regular expression check.");
            return false;
         }
         if (version_list.indexOf(test_version) < 0) {
            // window.alert("Failed supported versions check.");
            return false;
         }
         target_version = 'v' + test_version;
         has_version = true;
         has_rtd_format = true;
         // window.alert("Passed. Target version set to: " + target_version);
         return true;
      }

      function is_gh_version(test_version) {
         // window.alert("Testing GH version: " + test_version);
         if (test_version.search(re_version2) < 0) {
            // window.alert("Failed regular expression check.");
            return false;
         }
         var temp = test_version.substring(1);
         if (version_list.indexOf(temp) < 0) {
            // window.alert("Failed supported versions check.");
            return false;
         }
         target_version = test_version;
         has_version = true;
         // window.alert("Passed. Target version set to: " + target_version);
         return true;
      }

      var counter = 1;
      if (is_language(src_path_parts[counter])) {
         counter += 1;
         if (counter < src_path_parts.length) {
            if ((is_rtd_version(src_path_parts[counter])) || (src_path_parts[counter].search(/^(latest|stable)$/) >= 0)) {
               if (is_rtd_version(src_path_parts[counter])) {
                  target_path = '/' + target_version;
               }
               else {
                  if (src_path_parts[counter] == 'stable') {
                     target_path = '/v' + latest_version;
                  }
               }
               counter += 1;
               target_path += '/' + target_language;
               while (counter < src_path_parts.length) {
                  target_path += '/' + src_path_parts[counter];
                  counter += 1;
               }
               target_url = src_protocol + '//' + src_host + target_path;
            }
         }
         if (target_url == '') {
            target_url = src_protocol + '//' + src_host + '/' + target_language + '/not_found.html';
         }
      }
      else {
         if (is_gh_version(src_path_parts[counter])) {
            counter += 1;
            if (is_language(src_path_parts[counter])) {
               target_url = src_protocol + '//' + src_host + '/' + target_version + '/' + target_language + '/not_found.html';
            }
         }
         if (target_url == '') {
            target_url = src_protocol + '//' + src_host + '/' + target_language + '/not_found.html';
         }
      }
      window.alert('Old URL: ' + window.location + "\nNew URL: " + target_url)
      window.location.replace(target_url);
   </script>
</body>
</html>
